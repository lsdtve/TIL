# Transaction

>트랜잭션은 데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위
>
>또는 한꺼번에 모두 수행되어야 할 일련의 연산들을 의미한다.



### 트렌잭션의 성질

- **원자성(Atomicity)** : 한 트랜잭션 내에서 실행한 작업들은 하나로 간주한다. 즉, 모두 성공 또는 모두 실패. 

- **일관성(Consistency)** : 트랜잭션은 일관성 있는 데이타베이스 상태를 유지한다. (data integrity 만족 등.)

- **격리성(Isolation)** : 동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않도록 격리해야한다.

- **지속성(Durability)** : 트랜잭션을 성공적으로 마치면 결과가 항상 저장되어야 한다.



### 스프링의 트랜잭션

> 스프링에서 트랜잭션 처리는 어노테이션 방식으로 @Transactional을 선언하여 사용한다
>
> 선언적 트랜잭션이라 부른다.

- 클래스, 인터페이스, 메소드에 사용할 수 있으며, 메소드에 가장 가까운 애노테이션이 우선 순위가 높다.
- **@Transactional** 이 추가되면, 이 클래스에 트랜잭션 기능이 적용된 프록시 객체가 생성된다.
- 이 프록시 객체는 **@Transactional**이 포함된 메소드가 호출 될 경우, **PlatformTransactionManager**를 사용하여 트랜잭션을 시작하고, 정상 여부에 따라 Commit 또는 Rollback 한다.



### 트랜잭션 속성

1. **isolation** (격리수준)

   트랜잭션에서 일관성이 없는 데이터를 허용하도록 하는 수준을 말한다.

   - **DEFAULT** 
     - 기본 격리 수준 (DB의 Isolation Level을 따름
     - mariaDb는REPEATABLE_READ

   - **READ_COMMITTED**

     - 트랜잭션이 커밋 된 확정 데이터만 읽기 허용

   - **REPEATABLE_READ** : 

     - 트랜잭션이 완료될 때까지 SELECT 문장이 사용하는 모든 데이터에 **shared lock**이 걸리므로 다른 사용자는 그 영역에 해당되는 데이터에 대한 수정이 불가능

   - **SERIALIZABLE**

     - 데이터의 일관성 및 동시성을 위해 MVCC(Multi Version Concurrency Control)을 사용하지 않음

       

2. **propagation** (전파옵션)

   트랜잭션 동작 도중 다른 트랜잭션을 호출하는 상황에 선택하는 옵션

   - **REQUIRED**

     - 디폴트 속성, 부모 트랜잭션 내에서 실행하며 부모 트랜잭션이 없을 경우 새로운 트랜잭션을 생성한다.

   - **SUPPORTS**

     - 이미 시작된 트랜잭션이 있으면 참여하고 그렇지 않으면 트랜잭션 없이 진행하게 만든다. 

   - **REQUIRES_NEW**

     - 부모 트랜잭션을 무시하고 무조건 새로운 트랜잭션이 생성

   - **REQUIRES_NEW**
- 항상 새로운 트랜잭션을 시작한다.
     
- 이미 진행 중인 트랜잭션이 있으면 트랜잭션을 잠시 보류시킨다.

