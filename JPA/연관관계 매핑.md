# 연관관계 매핑

**객체를 테이블에 맞추어 데이터 중심으로 모델링하면, 협력 관계를 만들 수 없습니다.**

- **테이블은 외래 키로 조인**을 사용해서 연관된 테이블을 찾습니다.
- **객체 참조**를 사용해서 연관된 객체를 찾습니다.
- 테이블과 객체 사이에는 이런 큰 간격이 있습니다.



## 단방향 연관관계



<img src="images/image-20210330133137321.png" alt="image-20210330133137321" style="zoom: 50%;" />

```java
@Entity
public class Member {

  @Id @GeneratedValue
  private Long id;
  
  @Column(name = "USERNAME")
  private String name;
  private int age;
  
  @ManyToOne
  @JoinColumn(name = "TEAM_ID")
  private Team team;
  
}
```

- 다음과 같이 `@ManyToOne`, `@JoinColumn`으로 객체의 참조와 테이블의 외래 키를 매핑하였다.

<img src="images/image-20210330133606684.png" alt="image-20210330133606684" style="zoom:50%;" />



## 양방향 연관관계

```java
@Entity
public class Team {
  
  @Id @GeneratedValue
  private Long id;
  
  private String name;

  @OneToMany(mappedBy = "team")
  List<Member> members = new ArrayList<Member>();
}
```

<img src="images/image-20210330134119194.png" alt="image-20210330134119194" style="zoom:50%;" />



- 객체의 **양방향 관계는 사실 양방향 관계가 아니라 서로 다른 단 뱡향 관계 2개**다
- 객체를 양방향으로 참조하려면 **단방향 연관관계를 2개** 만들어 야 한다.



### 연관관계의 주인 (Owner)

- 객체의 두 관계중 하나를 연관관계의 주인으로 지정
- 연관관계의 주인만이 외래 키를 관리(등록, 수정)
- 주인이 아닌쪽은 읽기만 가능
- 주인은 mappedBy 속성 사용 X
- 주인이 아니면 mappedBy 속성으로 주인 지정



### [주의]

- 순수 객체 상태를 고려해서 항상 양쪽에 값을 설정하자
- 연관 관계 편의 메소드를 생성하자
- 양방향 매핑시에 무한 루프를 조심하자

